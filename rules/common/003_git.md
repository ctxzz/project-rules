# Git管理ガイドライン

## 基本方針

1. **ブランチ戦略**
   - メインブランチ: `main`（本番環境用）
   - 開発ブランチ: `develop`（開発環境用）
   - 機能ブランチ: `feature/*`（新機能開発用）
   - バグ修正ブランチ: `fix/*`（バグ修正用）
   - リリースブランチ: `release/*`（リリース準備用）

2. **コミットメッセージ**
   - 形式: `<type>(<scope>): <subject>`
   - 例: `feat(api): add user authentication endpoint`
   - タイプ:
     - `feat`: 新機能
     - `fix`: バグ修正
     - `docs`: ドキュメント変更
     - `style`: コードスタイル変更
     - `refactor`: リファクタリング
     - `test`: テスト追加・修正
     - `chore`: ビルドプロセスやツールの変更

3. **プルリクエスト**
   - 1つのPRは1つの機能/修正に集中
   - レビュー前に自己レビューを実施
   - 関連するIssueをリンク
   - 変更内容を明確に説明

## ワークフロー

### コミットの作成

1. **変更の確認**
   ```bash
   # 未追跡ファイルと変更の確認
   git status

   # 変更内容の詳細確認
   git diff

   # コミットメッセージのスタイル確認
   git log
   ```

2. **変更の分析**
   - 変更または追加されたファイルの特定
   - 変更の性質（新機能、バグ修正、リファクタリングなど）の把握
   - プロジェクトへの影響評価
   - 機密情報の有無確認

3. **コミットメッセージの作成**
   - 「なぜ」に焦点を当てる
   - 明確で簡潔な言葉を使用
   - 変更の目的を正確に反映
   - 一般的な表現を避ける

4. **コミットの実行**
   ```bash
   # 関連ファイルのみをステージング
   git add <files>

   # コミットメッセージの作成（HEREDOCを使用）
   git commit -m "$(cat <<'EOF'
   feat: ユーザー認証にResult型を導入

   - エラー処理をより型安全に
   - エラーケースの明示的な処理を強制
   - テストの改善

   🤖 ${K4}で生成
   Co-Authored-By: Claude noreply@anthropic.com
   EOF
   )"
   ```

### プルリクエストの作成

1. **ブランチの状態確認**
   ```bash
   # 未コミットの変更確認
   git status

   # 変更内容の確認
   git diff

   # mainからの差分確認
   git diff main...HEAD

   # コミット履歴の確認
   git log
   ```

2. **変更の分析**
   - mainから分岐後のすべてのコミットの確認
   - 変更の性質と目的の把握
   - プロジェクトへの影響評価
   - 機密情報の有無確認

3. **プルリクエストの作成**
   ```bash
   # プルリクエストの作成（HEREDOCを使用）
   gh pr create --title "feat: Result型によるエラー処理の改善" --body "$(cat <<'EOF'
   ## 概要

   エラー処理をより型安全にするため、Result型を導入しました。

   ## 変更内容

   - neverthrowを使用したResult型の導入
   - エラーケースの明示的な型定義
   - テストケースの追加

   ## レビューのポイント

   - Result型の使用方法が適切か
   - エラーケースの網羅性
   - テストの十分性
   EOF
   )"
   ```

## メモリバンクとの連携

1. **変更履歴の管理**
   - 重要な変更はメモリバンクに記録
   - コミットメッセージとメモリバンクの更新を同期
   - 技術的決定事項は両方に記録

2. **ブランチ命名規則**
   - 機能ブランチ: `feature/feature-name`
   - バグ修正: `fix/bug-name`
   - リリース: `release/version`
   - ホットフィックス: `hotfix/issue-name`

3. **タグ管理**
   - リリース時にタグを作成
   - セマンティックバージョニングに従う
   - タグメッセージに変更内容を記載

## 注意事項

1. **コンフリクト解消**
   - 定期的な`develop`ブランチとの同期
   - コンフリクトは早めに解消
   - 解消方法をメモリバンクに記録

2. **レビュー基準**
   - コード品質の確認
   - テストの存在確認
   - ドキュメントの更新確認
   - パフォーマンスへの影響確認

3. **セキュリティ**
   - 機密情報を含むコミットの禁止
   - 認証情報の適切な管理
   - セキュリティ関連の修正は優先対応

4. **避けるべき操作**
   - 対話的なgitコマンド（-iフラグ）の使用
   - リモートリポジトリへの直接プッシュ
   - git設定の変更

## コミットメッセージの例

```bash
# 新機能の追加
feat: Result型によるエラー処理の導入

# 既存機能の改善
update: キャッシュ機能のパフォーマンス改善

# バグ修正
fix: 認証トークンの期限切れ処理を修正

# リファクタリング
refactor: Adapterパターンを使用して外部依存を抽象化

# テスト追加
test: Result型のエラーケースのテストを追加

# ドキュメント更新
docs: エラー処理のベストプラクティスを追加
```

## プルリクエストの例

```markdown
## 概要

TypeScriptのエラー処理をより型安全にするため、Result型を導入しました。

## 変更内容

- neverthrowライブラリの導入
- APIクライアントでのResult型の使用
- エラーケースの型定義
- テストケースの追加

## 技術的な詳細

- 既存の例外処理をResult型に置き換え
- エラー型の共通化
- モック実装の改善

## レビューのポイント

- Result型の使用方法が適切か
- エラーケースの網羅性
- テストの十分性
``` 